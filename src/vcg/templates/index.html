{% extends "base.html" %}
{% block content %}
<div id="sidebar">
<div id="existing-cards">
    {% for card in session.get("cards", []) %}
        {% include "partials/full_card.html" with context %}
    {% endfor %}
</div>
<div id="new-card">
{% with flashes = get_flashed_messages(with_categories=True) %}
    {% if flashes %}
        <ul class="flashes">
        {% for category, message in flashes %}
            <li class="{{ category }}">{{ message }}</li>
        {% endfor %}
        </ul>
    {% endif %}
{% endwith %}
<form>
    <select name="book">
    {% with selbook = session.get("book") %}
    {% for key, book in bookmap %}
        <option value="{{key}}" {% if key == selbook %}selected{% endif %}>{{ book }}</option>
    {% endfor %}
    {% endwith %}
    </select>
    <input name="chapvers" type="text" value="{{ session.get("chapvers", "") }}" autofocus>
    <button hx-post="{{ url_for('add_card') }}" hx-target="#existing-cards" hx-swap="beforeend">Add</button>
</form>
<hr>
<details><summary>Global Options</summary>
    {% include "partials/view_global_options.html" %}
</details>
<hr>
<form method="post">
    <input name="action" type="submit" value="Reset" onclick="return confirm('Are you SURE you want to reset and lose all your verse cards?!!')">
</form>
</div>
</div>
<div id="preview-frame">
    <div id="iframe-socket">{% if session.get("auto_update", True) -%}
        {% set fmt = session.get("preview_fmt", "PDF") %}
        {% include "partials/preview-window.html" %}
    {%- endif %}</div>
    {% include "partials/preview-config-form.html" with context %}
</div>
{% endblock %}
